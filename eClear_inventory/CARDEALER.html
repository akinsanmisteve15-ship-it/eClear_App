<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eClear | Carbox Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0B0E14; --sidebar: #12161D; --brand-red: #FF3B30;
            --card-dark: #1A1F26; --border: rgba(255,255,255,0.08);
            --text-main: #FFFFFF; --text-dim: #717789; --success: #00FF00; --danger: #FF4D4D; --warning: #FFAB00;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text-main); display: flex; min-height: 100vh; overflow: hidden; }

        /* --- SIDEBAR --- */
        .sidebar { width: 260px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 32px; display: flex; flex-direction: column; flex-shrink: 0; }
        .logo { font-size: 22px; font-weight: 800; color: var(--brand-red); margin-bottom: 40px; }
        .nav-group { margin-bottom: 25px; }
        .nav-label { font-size: 10px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 12px; display: block; font-weight: 700; }
        .nav-item { display: flex; align-items: center; padding: 12px 16px; color: var(--text-dim); border-radius: 12px; font-size: 13px; margin-bottom: 4px; cursor: pointer; transition: 0.2s; }
        .nav-item.active { background: var(--brand-red); color: #fff; font-weight: 600; }

        .main-container { flex: 1; padding: 40px; overflow-y: auto; }
        .content-section { display: none; }
        .content-section.active { display: block; }

        /* --- INVENTORY LEDGER --- */
        .ledger-header { display: grid; grid-template-columns: 70px 1.5fr 1fr 1fr 1.2fr 1fr 120px; padding: 15px 20px; color: var(--text-dim); font-size: 11px; font-weight: 800; border-bottom: 1px solid var(--border); }
        .ledger-row { background: var(--card-dark); border: 1px solid var(--border); border-radius: 14px; padding: 12px 20px; display: grid; grid-template-columns: 70px 1.5fr 1fr 1fr 1.2fr 1fr 120px; align-items: center; gap: 15px; margin-bottom: 8px; }
        .brand-logo-circle { width: 42px; height: 42px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; padding: 6px; }
        .brand-logo-circle img { width: 100%; height: 100%; object-fit: contain; }

        /* --- LIVE LISTING GRID --- */
        .listing-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .v-card { background: var(--card-dark); border: 1px solid var(--border); border-radius: 24px; padding: 20px; position: relative; }
        .v-card-img { width: 100%; height: 240px; border-radius: 18px; object-fit: cover; }

        .btn-red { background: var(--brand-red); color: #fff; border: none; padding: 12px 24px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        
        #conn-status { font-size: 10px; margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border); font-weight: 800; }
        .status-online { color: var(--success); }
        .status-offline { color: var(--warning); }

        .stale-tag { font-size: 10px; font-weight: 800; padding: 4px 8px; border-radius: 5px; border: 1px solid var(--danger); color: var(--danger); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="logo">‚öôÔ∏è Carbox</div>
        <nav class="nav-group">
            <span class="nav-label">Main</span>
            <div class="nav-item" onclick="showSection('dashboard', this)">Dashboard</div>
            <div class="nav-item active" onclick="showSection('inventory', this)">Inventory</div>
            <div class="nav-item" onclick="showSection('listing', this)">Live Listing</div>
        </nav>
        <nav class="nav-group">
            <span class="nav-label">Operations</span>
            <div class="nav-item" onclick="showSection('customers', this)">Customers</div>
            <div class="nav-item" onclick="showSection('transactions', this)">Transactions</div>
            <div class="nav-item" onclick="showSection('messages', this)">Messages</div>
        </nav>
        <div id="conn-status" class="status-online">‚óè SYSTEM ONLINE</div>
    </aside>

    <main class="main-container">
        <section id="dashboard" class="content-section">
            <h1>Dashboard Overview</h1>
            <p style="color:var(--text-dim)">Welcome back, dealer.</p>
        </section>

        <section id="inventory" class="content-section active">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 30px;">
                <h1>Inventory Ledger</h1>
                <button class="btn-red" onclick="openModal()">+ Add Vehicle</button>
            </div>
            <div class="ledger-header">
                <div>Logo</div><div>Vehicle</div><div>Year</div><div>Age</div><div>Price</div><div>Status</div><div>Actions</div>
            </div>
            <div id="ledger-items"></div>
        </section>

        <section id="listing" class="content-section">
            <h1 style="margin-bottom:30px;">Live Storefront</h1>
            <div id="listing-grid" class="listing-grid"></div>
        </section>
    </main>

    <div id="upload-modal" class="modal-overlay" style="position: fixed; inset: 0; background: rgba(5, 7, 10, 0.98); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(20px);">
    <div class="ai-modal" style="background: #12161D; width: 550px; border-radius: 32px; border: 1px solid rgba(255,255,255,0.05); overflow: hidden; position: relative;">
        <div id="modal-progress" style="position:absolute; top:0; left:0; height:3px; background:var(--brand-red); width:0%; transition: width 0.4s ease;"></div>

        <div style="padding: 40px;">
            <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:40px;">
                <div>
                    <span id="step-count" style="font-size:10px; font-weight:800; color:var(--brand-red); text-transform:uppercase; letter-spacing:2px; display:block; margin-bottom:4px;">STEP 1 / 7</span>
                    <h2 id="step-title" style="font-size:24px; font-weight:700; letter-spacing:-0.5px;">Exterior Photos</h2>
                </div>
                <button onclick="closeModal()" style="background:none; border:none; color:var(--text-dim); cursor:pointer; font-size:20px;">&times;</button>
            </div>

            <div id="upload-zone" style="min-height: 280px; display: flex; flex-direction: column; justify-content: center;">
                </div>

            <div style="margin-top: 40px; display: flex; align-items: center; gap: 15px;">
                <button id="skip-btn" style="background:rgba(255,255,255,0.05); border:none; color:var(--text-dim); padding:16px 24px; border-radius:16px; font-weight:600; cursor:pointer; font-size:13px; display:none;">Skip</button>
                <button id="next-btn" class="btn-red" style="flex:1; height:56px; border-radius:16px; font-size:15px; box-shadow: 0 10px 20px rgba(255, 59, 48, 0.2);" onclick="nextStep()">Continue</button>
            </div>
        </div>
    </div>
</div>

    <script>
        // --- STATE MANAGEMENT ---
let currentStep = 1;
const stock = [];
let pendingData = { make: '', model: '', year: '', price: '' };

// --- MODAL CONTROL ---
function openModal() {
    currentStep = 1;
    pendingData = { make: '', model: '', year: '', price: '' };
    document.getElementById('upload-modal').style.display = 'flex';
    updateStepUI();
}

function closeModal() {
    document.getElementById('upload-modal').style.display = 'none';
}

// --- CORE WORKFLOW ENGINE ---
function updateStepUI() {
    const title = document.getElementById('step-title');
    const count = document.getElementById('step-count');
    const nextBtn = document.getElementById('next-btn');
    const skipBtn = document.getElementById('skip-btn');
    const zone = document.getElementById('upload-zone');
    const progress = document.getElementById('modal-progress');

    // UI Reset & Progress
    progress.style.width = `${(currentStep / 7) * 100}%`;
    nextBtn.style.opacity = "0.4";
    nextBtn.style.pointerEvents = "none";
    nextBtn.innerText = currentStep === 7 ? "Finalize Listing" : "Continue";
    skipBtn.style.display = "none";

    switch(currentStep) {
        case 1:
        case 2:
            title.innerText = currentStep === 1 ? "Exterior View" : "Interior Details";
            count.innerText = `STEP ${currentStep} / 7`;
            zone.innerHTML = `
                <div onclick="document.getElementById('media-in').click()" style="border: 2px dashed rgba(255,255,255,0.1); border-radius:24px; padding:40px; text-align:center; cursor:pointer; background:rgba(255,255,255,0.02); transition:0.3s;" onmouseover="this.style.borderColor='var(--brand-red)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'">
                    <input type="file" id="media-in" multiple accept="image/*" style="display:none" onchange="handleMediaPreview(this)">
                    <div style="font-size:32px; margin-bottom:12px;">üì∏</div>
                    <p style="font-weight:600; font-size:14px; margin-bottom:4px;">Upload vehicle photos</p>
                    <p style="color:var(--text-dim); font-size:12px;">Drag and drop or click to browse</p>
                </div>
                <div id="preview-area" style="display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-top:20px;"></div>
            `;
            nextBtn.onclick = () => { currentStep++; updateStepUI(); };
            break;

        case 3: // VIDEO
            title.innerText = "Walkaround Video";
            count.innerText = `STEP 3 / 7`;
            zone.innerHTML = `
                <div onclick="document.getElementById('media-in').click()" style="border: 2px dashed rgba(255,255,255,0.1); border-radius:24px; padding:40px; text-align:center; cursor:pointer; background:rgba(255,255,255,0.02);">
                    <input type="file" id="media-in" accept="video/*" style="display:none" onchange="unlockNext()">
                    <div style="font-size:32px; margin-bottom:12px;">üé•</div>
                    <p style="font-weight:600; font-size:14px;">Upload short video</p>
                    <p style="color:var(--text-dim); font-size:12px;">Max 30 seconds recommended</p>
                </div>
                <div id="preview-area" style="text-align:center; margin-top:15px; font-size:12px; color:var(--success);"></div>
            `;
            nextBtn.onclick = () => { currentStep++; updateStepUI(); };
            break;

        case 4: // VIN
            title.innerText = "Vehicle Identity";
            count.innerText = `STEP 4 / 7`;
            skipBtn.style.display = "block";
            skipBtn.innerText = "I don't have a VIN";
            skipBtn.onclick = () => { currentStep = 5; updateStepUI(); };
            zone.innerHTML = `
                <p style="color:var(--text-dim); font-size:13px; margin-bottom:15px;">Enter the 17-digit VIN to instantly pull car specs.</p>
                <input type="text" id="vin-input" placeholder="WBA1234567890..." style="width:100%; padding:20px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:#fff; border-radius:16px; font-family:monospace; font-size:20px; text-transform:uppercase; letter-spacing:2px;">
            `;
            nextBtn.style.opacity = "1"; nextBtn.style.pointerEvents = "auto";
            nextBtn.innerText = "Identify Vehicle";
            nextBtn.onclick = handleVinLogic;
            break;

        case 5: // MANUAL REVIEW
            title.innerText = "Review Details";
            count.innerText = `STEP 5 / 7`;
            zone.innerHTML = `
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <div class="input-group"><label style="font-size:10px; color:var(--text-dim); margin-left:12px;">MAKE</label><input id="m-make" value="${pendingData.make}" style="width:100%; padding:14px; background:rgba(255,255,255,0.05); border:1px solid var(--border); color:#fff; border-radius:12px; margin-top:4px;"></div>
                    <div class="input-group"><label style="font-size:10px; color:var(--text-dim); margin-left:12px;">MODEL</label><input id="m-model" value="${pendingData.model}" style="width:100%; padding:14px; background:rgba(255,255,255,0.05); border:1px solid var(--border); color:#fff; border-radius:12px; margin-top:4px;"></div>
                    <div class="input-group"><label style="font-size:10px; color:var(--text-dim); margin-left:12px;">YEAR</label><input id="m-year" value="${pendingData.year}" style="width:100%; padding:14px; background:rgba(255,255,255,0.05); border:1px solid var(--border); color:#fff; border-radius:12px; margin-top:4px;"></div>
                    <div class="input-group"><label style="font-size:10px; color:var(--text-dim); margin-left:12px;">PRICE (‚Ç¶)</label><input id="m-price" value="${pendingData.price}" style="width:100%; padding:14px; background:rgba(255,255,255,0.05); border:1px solid var(--border); color:#fff; border-radius:12px; margin-top:4px;"></div>
                </div>
            `;
            nextBtn.style.opacity = "1"; nextBtn.style.pointerEvents = "auto";
            nextBtn.onclick = () => { saveManual(); currentStep++; updateStepUI(); };
            break;

        case 6: // 360 INSPECTION
            title.innerText = "360¬∞ Inspection";
            count.innerText = `STEP 6 / 7`;
            skipBtn.style.display = "block";
            skipBtn.innerText = "Skip for now";
            skipBtn.onclick = () => { currentStep++; updateStepUI(); };
            zone.innerHTML = `
                <div style="text-align:center;">
                    <div style="font-size:48px; margin-bottom:16px;">üîÑ</div>
                    <p style="font-weight:600; font-size:14px; margin-bottom:8px;">Capture 360¬∞ Exterior</p>
                    <p style="color:var(--text-dim); font-size:12px; margin-bottom:24px;">Upload a sequence of photos or a panoramic spin.</p>
                    <button class="btn-red" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.1);" onclick="unlockNext()">Upload Spin Asset</button>
                </div>
            `;
            nextBtn.onclick = () => { currentStep++; updateStepUI(); };
            break;

        case 7: // VR INSPECTION
            title.innerText = "VR Experience";
            count.innerText = `STEP 7 / 7`;
            skipBtn.style.display = "block";
            skipBtn.innerText = "Skip & Finish";
            skipBtn.onclick = () => finish();
            zone.innerHTML = `
                <div style="text-align:center;">
                    <div style="font-size:48px; margin-bottom:16px;">üï∂Ô∏è</div>
                    <p style="font-weight:600; font-size:14px; margin-bottom:8px;">Interior VR/Spatial Scan</p>
                    <p style="color:var(--text-dim); font-size:12px; margin-bottom:24px;">Add immersive spatial data for VR-enabled buyers.</p>
                    <button class="btn-red" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.1);" onclick="unlockNext()">Upload VR Data</button>
                </div>
            `;
            nextBtn.onclick = () => finish();
            break;
    }
}

// --- RENDERING ---
function renderUI() {
    const ledger = document.getElementById('ledger-items');
    ledger.innerHTML = stock.length ? stock.map(item => `
        <div class="ledger-row">
            <div class="brand-logo-circle"><img src="${item.logo}" onerror="this.src='https://www.carlogos.org/car-logos/toyota-logo.png';"></div>
            <div style="font-weight:700;">${item.make} ${item.model}</div>
            <div style="color:var(--text-dim);">${item.year}</div>
            <div><span class="stale-tag">NEW</span></div>
            <div style="color:var(--brand-red); font-weight:800;">‚Ç¶${parseInt(item.price).toLocaleString()}</div>
            <div style="font-size:11px;">‚óè ${item.status.toUpperCase()}</div>
            <button class="btn-red" style="padding:5px 10px; font-size:10px;">Edit</button>
        </div>
    `).join('') : '<p style="text-align:center; padding:40px; color:var(--text-dim);">No vehicles in ledger.</p>';
}

// --- LOGIC HELPERS ---
function handleMediaPreview(input) {
    const area = document.getElementById('preview-area');
    area.innerHTML = "";
    Array.from(input.files).slice(0, 4).forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
            area.innerHTML += `<div style="height:60px; background:url(${e.target.result}) center/cover; border-radius:8px; border:1px solid var(--border);"></div>`;
        };
        reader.readAsDataURL(file);
    });
    unlockNext();
}

function unlockNext() {
    const b = document.getElementById('next-btn');
    b.style.opacity = "1"; b.style.pointerEvents = "auto";
    if(currentStep === 3) document.getElementById('preview-area').innerText = "‚úÖ Video Loaded";
}

async function handleVinLogic() {
    const vin = document.getElementById('vin-input').value;
    if(vin) {
        try {
            const res = await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVin/${vin}?format=json`);
            const data = await res.json();
            const r = {};
            data.Results.forEach(i => r[i.Variable] = i.Value);
            pendingData = { make: r.Make || '', model: r.Model || '', year: r.ModelYear || '', price: '' };
        } catch(e) { console.log("VIN fail"); }
    }
    currentStep = 5;
    updateStepUI();
}

function saveManual() {
    pendingData = {
        make: document.getElementById('m-make').value,
        model: document.getElementById('m-model').value,
        year: document.getElementById('m-year').value,
        price: document.getElementById('m-price').value
    };
}

function finish() {
    const cleanMake = pendingData.make.toLowerCase().replace(/\s+/g, '-');
    stock.push({ ...pendingData, id: Date.now(), status: 'Live', logo: `https://www.carlogos.org/car-logos/${cleanMake}-logo.png` });
    closeModal();
    renderUI();
    triggerSyncPopup();
}

function triggerSyncPopup() {
    const overlay = document.createElement('div');
    overlay.style = "position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:9000; display:flex; align-items:center; justify-content:center; backdrop-filter:blur(15px);";
    overlay.innerHTML = `
        <div style="background:#12161D; padding:40px; border-radius:35px; border:1px solid var(--border); width:440px; text-align:center;">
            <div style="font-size:40px; margin-bottom:15px;">üöÄ</div>
            <h2 style="margin-bottom:8px;">Listing Sync</h2>
            <div style="display:flex; justify-content:center; gap:20px; margin:30px 0;">
                <img class="sync-icon active" onclick="this.classList.toggle('active')" src="https://upload.wikimedia.org/wikipedia/commons/0/05/Facebook_Logo_(2019).png" style="width:45px; cursor:pointer;">
                <img class="sync-icon active" onclick="this.classList.toggle('active')" src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg" style="width:45px; cursor:pointer;">
                <img class="sync-icon active" onclick="this.classList.toggle('active')" src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_Logo.svg" style="width:45px; cursor:pointer;">
            </div>
            <button class="btn-red" style="width:100%;" onclick="this.parentElement.parentElement.remove()">Push to Selected</button>
        </div>
        <style>.sync-icon { filter: grayscale(1); opacity: 0.4; transition: 0.3s; } .sync-icon.active { filter: grayscale(0); opacity: 1; transform: scale(1.1); }</style>
    `;
    document.body.appendChild(overlay);
}

// Initial Render
renderUI();
    </script>
</body>
</html>